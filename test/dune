(executable
 (name test)
 (libraries alcotest core runtime)
 (preprocess
  (pps ppx_deriving_yojson)))

(rule
 (targets test_pb.ml)
 (deps
  (:plugin ../src/protocell/protocell.exe)
  (:proto test_pb.proto))
 (action
  (run protoc --plugin=protoc-gen-ocaml=%{plugin} --ocaml_out=. %{proto})))

(alias
 (name runtest)
 (deps
  (:test test.exe)
  test_pb.proto)
 (action
  (run %{test} --color=always)))
